<!doctype html>
<html lang="pt-BR">
<head>
<link rel="icon" href="logo.png" type="image/png">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador de Comunicações — Consórcio Fênix</title>

<style>
:root{
  --primary:#002A42;
  --secondary:#FFCC00;
  --bg:#f5f7fa;
  --text:#1b2a31;
  --muted:#73828c;
  --card:#ffffff;
}

*{
  box-sizing:border-box;
}

body{
  margin:0;
  font-family:"Inter", Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */
.header{
  width:100%;
  background:var(--secondary);
  color:var(--primary);
  padding:26px 0 22px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
.header .container{
  max-width:1120px;
  margin:auto;
  padding:0 22px;
}
.header-title{
  font-size:30px;
  font-weight:800;
  color:var(--primary);
}
.header-sub{
  font-size:15px;
  margin-top:4px;
  opacity:0.95;
  font-weight:500;
}

.container{
  max-width:1120px;
  margin:32px auto;
  padding:0 22px;
}

h1{
  font-size:26px;
  margin:0 0 20px;
  color:var(--primary);
  font-weight:700;
}

/* CARD */
.card{
  background:var(--card);
  border-radius:14px;
  padding:28px 24px;
  box-shadow:0 6px 18px rgba(0,0,0,0.1);
  border-left:8px solid var(--secondary);
  margin-bottom:26px;
}

/* GRID */
.row{
  display:flex;
  gap:16px;
  flex-wrap:wrap;
}
.col{
  flex:1;
  min-width:280px;
}

label{
  display:block;
  font-weight:700;
  margin:8px 0 6px;
  color:var(--primary);
  font-size:15px;
}

select,input,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:2px solid #cdd6de;
  font-size:15px;
  background:#fff;
  color:var(--text);
  transition:0.2s;
}
select:focus,input:focus,textarea:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(0,42,66,0.25);
  outline:none;
}

textarea{
  min-height:180px;
  resize:vertical;
  border:2px solid var(--primary);
}

.small{
  font-size:13px;
  color:var(--muted);
  margin-top:6px;
}

.btn{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  transition:0.2s;
}
.btn:hover{ background:#001c2d; }

.btn.ghost{
  background:#fff;
  border:2px solid var(--primary);
  color:var(--primary);
}
.btn.ghost:hover{
  background:var(--primary);
  color:#fff;
}

.actions{
  display:flex;
  gap:12px;
  margin-top:10px;
}
</style>
</head>
<body>

<div class="header">
  <div class="container">
    <div class="header-title">Gerador de Comunicações</div>
    <div class="header-sub">Consórcio Fênix — Uso interno dos controladores</div>
  </div>
</div>

<div class="container">
  <h1>Gerador de Comunicações</h1>

  <div class="card">
    <div class="row">
      <div class="col">
        <label for="categoria">Categoria:</label>
        <select id="categoria" onchange="onCategoriaChange()">
          <option value="">-- Selecione uma categoria --</option>

<script>

// ================================
// FUNÇÃO: Montar campos dinamicamente
// ================================
function onCategoriaChange() {
  const cat = document.getElementById('categoria').value;
  const area = document.getElementById('camposArea');

  area.innerHTML = '';
  document.getElementById('resultado').value = '';

  if (!cat) return;

  const fields = FIELDS_BY_CATEGORY[cat] || [];

  if (fields.length === 0) {
    area.innerHTML = `<div class="small">Este modelo não requer campos adicionais. Clique em "Gerar Texto".</div>`;
    return;
  }

  let html = `<div class="grid2">`;
  for (let f of fields) {
    html += `
      <div class="field">
        <label for="f_${f.k}">${f.label}</label>
        <input id="f_${f.k}" data-key="${f.k}" type="text" placeholder="${f.label}">
      </div>
    `;
  }
  html += `</div>`;
  area.innerHTML = html;
}

// ================================
// FORMATAÇÃO INTELIGENTE DE LOCAIS
// ================================
function formatarLocal(chave, valor, isProximo) {

    if (!valor) return "";

    const v = valor.trim();

    // 1 — já existe preposição
    if (/^(do|da|dos|das|no|na|nos|nas|em|à|ao|a|às|aos)\b/i.test(v)) {
        return v;
    }

    const palavras = v.split(/\s+/);
    const primeira = palavras[0].toLowerCase();
    const ultima = palavras[palavras.length - 1].toLowerCase();
    const rawFirst = palavras[0].replace(/[.,]/g, "");

    // CASOS ESPECIAIS
    if (/^parte\b/i.test(v)) {
        return `em ${v}`;
    }

    // Rodovias
    if (/^(sc|br)-?\d+/i.test(v) || /^rodovia\b/i.test(primeira)) {
        return (isProximo ? "à " : "na ") + v;
    }

    // Siglas e instituições
    if (/^[A-Z]{2,8}$/.test(rawFirst)) {
        return (isProximo ? "à " : "na ") + v;
    }

    if (primeira.startsWith("uni")) {
        return (isProximo ? "à " : "na ") + v;
    }

    // Plurais
    if (ultima.endsWith("as"))
        return (isProximo ? "às " : "nas ") + v;

    if (ultima.endsWith("os"))
        return (isProximo ? "aos " : "nos ") + v;

    // Feminino (terminado em A, Ã, ÇÃO etc.)
    if (primeira.endsWith("a") || primeira.endsWith("ã") ||
        primeira.endsWith("ção") || primeira.endsWith("dade")) {
        return (isProximo ? "à " : "na ") + v;
    }

    // Compostos do tipo Beira-Mar
    if (/^[A-Za-zÀ-ÿ]+-[A-Za-zÀ-ÿ]+$/.test(rawFirst)) {
        if (primeira.endsWith("a")) {
            return (isProximo ? "à " : "na ") + v;
        }
    }

    // Masculino padrão
    return (isProximo ? "ao " : "no ") + v;
}


// ================================
// FUNÇÃO PRINCIPAL: GERAR TEXTO
// ================================
function gerarTexto() {
  const cat = document.getElementById('categoria').value;
  if (!cat) { alert('Selecione uma categoria.'); return; }

  let texto = TEMPLATES[cat];
  if (!texto) { alert('Template não encontrado.'); return; }

  const fields = FIELDS_BY_CATEGORY[cat] || [];

  for (let f of fields) {
    const el = document.getElementById('f_' + f.k);
    const val = el ? el.value.trim() : '';
    const token = `__${f.k}__`;

    // LOCAL
    if (f.k === "local") {
      texto = texto.split(token).join(formatarLocal(f.k, val, false));
      continue;
    }

    // RUA DE RETORNO
    if (f.k === "rua_retorno") {
      texto = texto.split(token).join(formatarLocal(f.k, val, false));
      continue;
    }

    // PRÓXIMO
    if (f.k === "proximo") {
      texto = texto.split(token).join(formatarLocal(f.k, val, true));
      continue;
    }

    // CAMPOS SIMPLES
    texto = texto.split(token).join(val || '');
  }

  document.getElementById('resultado').value = texto;
}



// =============================================
// BOTÕES: Limpar e Copiar
// =============================================
function limpar() {
  document.getElementById('resultado').value = '';
  document.getElementById('camposArea').innerHTML = '';
  document.getElementById('categoria').value = '';
}

function copiar() {
  const out = document.getElementById('resultado');
  out.select();
  document.execCommand('copy');
  alert("Texto copiado!");
}



// =============================================
// TEMPLATES — COMPLETO E CORRIGIDO
// =============================================
const TEMPLATES = {

  "PM_SEM_SOCORRO": 
`Ônibus apresentou problemas mecânicos __local__. Equipe técnica foi acionada. Viagem pode sofrer atrasos.`,

  "PM_COM_SOCORRO": 
`Ônibus apresentou problemas mecânicos __local__. Socorro foi acionado e está a caminho. Viagem poderá atrasar.`,

  "ACIDENTE":
`Acidente registrado __local__. Desvio operacional sendo realizado __rua_retorno__. Possíveis atrasos nas viagens.`,

  "INTERDICAO":
`Via interditada __local__. Desvio sendo realizado __rua_retorno__. Condutores orientados.`,

  "RETENCAO":
`Trânsito lento __local__, próximo __proximo__. Viagens podem sofrer atrasos.`,

  "PARADA_IRREGULAR":
`Veículo parado de forma irregular __local__. Condutores orientados, podendo haver atrasos.`,

  "MANIFESTACAO":
`Manifestação __local__. Fluxo comprometido __rua_retorno__. Atrasos podem ocorrer.`,

  "ALAGAMENTO":
`Ponto de alagamento registrado __local__. Equipes orientando motoristas.`,

  "OBRA":
`Obra __local__. Desvio realizado __rua_retorno__. Atenção redobrada aos horários.`,

  "OUTROS":
`Registro recebido: __descricao__`
};



// =============================================
// CAMPOS DAS CATEGORIAS — COMPLETO
// =============================================
const FIELDS_BY_CATEGORY = {

  "PM_SEM_SOCORRO": [
    { k: "local", label: "Local" }
  ],

  "PM_COM_SOCORRO": [
    { k: "local", label: "Local" }
  ],

  "ACIDENTE": [
    { k: "local", label: "Local" },
    { k: "rua_retorno", label: "Desvio / Rua de retorno" }
  ],

  "INTERDICAO": [
    { k: "local", label: "Local" },
    { k: "rua_retorno", label: "Desvio / Rua de retorno" }
  ],

  "RETENCAO": [
    { k: "local", label: "Local" },
    { k: "proximo", label: "Próximo de" }
  ],

  "PARADA_IRREGULAR": [
    { k: "local", label: "Local" }
  ],

  "MANIFESTACAO": [
    { k: "local", label: "Local" },
    { k: "rua_retorno", label: "Desvio" }
  ],

  "ALAGAMENTO": [
    { k: "local", label: "Local" }
  ],

  "OBRA": [
    { k: "local", label: "Local" },
    { k: "rua_retorno", label: "Desvio" }
  ],

  "OUTROS": [
    { k: "descricao", label: "Descrição livre" }
  ]
};

</script>

</body>
</html>
